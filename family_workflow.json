{
  "name": "Family Comment Poster",
  "nodes": [
    {
      "name": "Webhook Receiver",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "receive-task",
        "authentication": "headerAuth",
        "headerAuth": {
          "name": "X-API-Key",
          "value": "{{$env.FAMILY_API_KEY}}"
        }
      }
    },
    {
      "name": "Get Comment Text",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": `
          const comments = {
            1: "My daughter counted the rice grains in our last meal. 47...",
            2: "Last night my son drew our old house from memory...",
            // ... all 20 comments
          };
          
          const commentNum = $input.item.json.comment_number;
          const comment = comments[commentNum];
          
          // Add family-specific variation
          const familyId = $env.FAMILY_ID;
          const variation = generateVariation(comment, familyId);
          
          return [{
            json: {
              comment: variation,
              post_url: $input.item.json.post_url
            }
          }];
        `
      }
    },
    {
      "name": "Human Delay",
      "type": "n8n-nodes-base.wait",
      "parameters": {
        "value": "={{Math.floor(Math.random() * 60 + 30)}}",
        "unit": "seconds"
      }
    },
    {
      "name": "Post Comment",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://www.instagram.com/web/comments/{{$json.post_id}}/add/",
        "method": "POST",
        "headers": {
          "User-Agent": "Mozilla/5.0 (iPhone; CPU iPhone OS 14_0)",
          "X-CSRFToken": "{{$env.INSTAGRAM_CSRF}}",
          "Cookie": "{{$env.INSTAGRAM_COOKIE}}"
        },
        "body": {
          "comment_text": "{{$json.comment}}"
        }
      }
    },
    {
      "name": "Report Success",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://gaza-protocol.up.railway.app/api/complete",
        "method": "POST",
        "headers": {
          "X-API-Key": "{{$env.FAMILY_API_KEY}}"
        },
        "body": {
          "post_url": "{{$json.post_url}}",
          "comment_posted": "{{$json.comment}}",
          "timestamp": "{{$now}}"
        }
      }
    }
  ]
}
