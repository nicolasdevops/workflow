name: Deploy Branch to Railway
on:
  pull_request:
    types: [opened, synchronize]
  push:
    branches:
      - main
      - 'gemini/**'
      - 'jules/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install Railway CLI
        run: npm i -g @railway/cli

      - name: Deploy to Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        # This logic checks if the branch is 'main'. If yes, it deploys to production. 
        # If not, it deploys to Jules1.
        run: |
          if [ "${{ github.ref_name }}" = "main" ]; then
            echo "Target: Production"
            railway up --service 27617f46-74e7-4bdb-939e-9d3779e7df76 --environment production --detach
          elif [[ "${{ github.ref_name }}" == gemini/* ]]; then
            echo "Target: Gemini Sandbox"
            railway up --service 27617f46-74e7-4bdb-939e-9d3779e7df76 --environment gemini-fix --detach
          else
            echo "Target: Jules Sandbox"
            railway up --service 27617f46-74e7-4bdb-939e-9d3779e7df76 --environment Jules1 --detach
          fi
